---
tags:
  - 데이터중심애플리케이션설계
  - 데이터베이스
최근 수정한 날짜: 2023-09-14 16:40:41
책 이름: 데이터중심 애플리케이션 설계
챕터: 1장
읽기 시작한 날짜: 2023-09-02
다 읽은 날짜: 2023-09-14
---


- 오늘날 많은 애플리케이션은 계산 중심과는 다르게 데이터 중심적이다.
- 데이터 중심 애플리케이션은 다음과 같은 기능들을 필요로 한다.
	- 구동 애플리케이션이나 다른 애플리케이션에서 나중에 다시 데이터를 찾을 수 있게 데이터를 저장(데이터 베이스)
	- 읽기 속도 향상을 위해 값비싼 수행 결과를 기억(캐시)
	- 사용자가 키워드로 데이터를 검색하거나 다양한 방법으로 필터링할 수 있게 제공( 검색 색인)
	- 비동기 처리를 위해 다른 프로세스로 메시지 보내기
	- 주기적으로 대량의 누적된 데이터를 분석( 일괄 처리)

## 신뢰성

- 누구나 어떤 것을 신뢰하거나 신뢰하지 않는다는 의미가 무엇인지에 대한 직관적인 개념을 가지고 있다
- 소프트웨어의 경우 일반적인 기대치는 다음과 같다.
	- 애플리케이션은 사용자가 기대한 기능을 수행한다.
	- 시스템은 사용자가 범한 실수나 예상치 못한 소프트웨어 사용법을 허용할 수 있다.
	- 시스템 성능은 예상된 부하와 데이터 양에서 필수적인 사용 사례를 충분히 만족한다.
	- 시스템은 허가되지 않은 접근과 오남용을 방지한다.
- 잘못될 수 있는 일을 ==결함== 이라고 부른다.
- 결함을 예측하고 대처할 수 있는 시스템을 ==내결함성== 또는 ==탄력성== 을가졌다고 한다.
- 결함과 장애는 동일하지 않다.
- ==장애==는 사용자에게 필요한 서비스를 제공하지 못하고 시스템 전체가 멈춘 경우다.

### 하드웨어 결함
- 시스템 장애율을 줄이기 위한 방법으로 각 하드웨어 구성 요소에 중복을 추가하는 방법이 일반적이다.
- 디스크는 RAID 구성
- 서버는 이중 전원 디바이스와 핫 스왑 가능한 CPU
- 데이터센터는 건전지와 예비 전원용 디젤 발전기를 갖출 수 있다.
- 최근에는 소프트웨어 내결함성 기술을 사용하거나 하드웨어 중복성을 추가해 전체 장비의 손실을 견딜 수 있는 시스템으로 발전 중

### 인적 오류
- 사람이 최선의 의도를 갖고 있어도 오류가 발생 할 수 있다.
- 운영자의 설정 오류가 중단의 주요 원인인 반면 , 하드웨어 결함은 중단 원인의 10~25%정도에 그친다.
- 오류의 가능성을 최소화 하는 방향으로 시스템 설계
	- 잘 설계된 추상화 , API , 관리 인터페이스를 사용한다.
- 사람이 가장 많이 실수하는 장소에서 사람의 실수로 장애가 발생 할 수 있는 부분을 분리
- 단위 테스트부터 시스템 통합 테스트까지 철저하게 테스트 하라.
- 인적 오류를 빠르고 쉽게 복구할 수 있게 하라
- 성능 지표와 오류율 같은 상세하고 명확한 모니터링 대책을 마련



### 확장성
- 성능 저하의 가장 흔한 이유는 부하 증가
- 확정성은 증가한 부하에 대처하는 시스템 능력을 설명하는 데 사용하는 용어

#### 부하 기술하기
- 부하는 부하 매개 변수라 부르는 몇 개의 숫자로 나타낼 수 있다.
- 부하 매개 변수 선택은 시스템의 설계에 따라 다르다.


#### 트위터 예시
- 트위터는 트윗 작성( 초당 4.6k, 피크일때 12k)
-  홈 타임라인(초당 300k) 주요 두 가지 동작이 있다.
- 트위터의 확장성 문제는 팬아웃 때문
- 개별 사용자는 많은 사람을 팔로우하고 많은 사람이 개별 사용자를 팔로우한다.

```sql
select tweets.*, users.* from tweets
	join users on tweets.sender_id = users.id
	join follows on follows.followee_id = users.id
	where follows.follower_id = current_user
```
- 쿼리는 새로운 트윗을 트윗 전역 컬렉션에 삽입
- 사용자가 타임라인을 요청하면 팔로우 하는 사람들의 모든 트윗을 찾아 시간순으로 정렬해서 합친다.

2. 각 사용자 트윗 우편함처럼 개별 사용자의 홈 타임라인 캐시를 유지한다.
	- 사용자가 트윗을 작성하면 해당 사용자를 팔로우하는 모든 사람을 찾고 각자의 홈 타임라인 캐시에 새로운 트윗을 삽입한다.
- 평균적으로 트윗 게시 요청량이 읽기 요청량에 비해 수백배 적기 때문에 접근 방식 2가 더 잘 동작한다.
- 접근 방식 2는 부가작업이 많이 필요하다. ( 예를 들어 팔로워수가 많은 사용자가 요청하면 더 오래 걸린다.)
- 팔로워가 많은 사용자는 따로 팬아웃에서 제외

## 성능 기술하기


- 하둡 같은 일괄 처리 시스템은 보통 `처리량(throughput)`이 중요
- 온라인 시스템에서는 `응답시간(Response Time`이 더 중요하다.
- 응답시간은 단일 숫자가 아니라 측정 가능한 값의 분포로 생각해야 한다.
- 일반적으로 평균보다는 백분위를 사용하는 것이 좋고, 95분위 99분위 99.9분위가 일반적이다.
- 큐 대기 지연은 높은 백분위에서 응답 시간의 상당 부분을 차지한다.
- 소수의 느린 요청만으로도 지연된다.

## 부하 대응 접근 방식
- 대개 대규모로 동작하는 시스템의 아키텍처는 해당 시스템을 사용하는 어플리케이션에특화 되어있음.
- 범용적이고 모든 상황에 맞는 확장 아키텍처는 없다.
- 주요 동작이 무엇이고 잘 하지 않는 동작이 무엇인지에 대한 가정이 중요하다.


## 유지보수성

- 레거시 만들지 않기 위한 시스템 설계 원칙 3가지
> 운용성 : 운영팀이 시스템을 원활하게 운영할수 있게 쉽게 만들어라

> 단순성: 시스템에서 복잡도를 최대한 제거해 새로운 엔지니어가 시스템을 이해하기 쉽게 만들어라

> 발전성 : 엔지니어가 이후 시스템을 쉽게 변경할수 있게 하라.



## 운용성 : 운영의 편리함 만들기

- 시스템 상태를 모니터링하고 상태가 좋지  않다면 빠르게 서비스를 복원
- 시스템 장애, 성능 저하 등의 문제의 원인을 추적
- 좋은 모니터링으로 런타임 동작과 시스템의 내부에 대한 가시성 제공
- 배포 설정 관리 등을 위한 모범 사례와 도구를 마련

## 단순성 : 복잡도 관리

- 복잡도는 다양한 증상으로 나타남
	- 상태 공간의 급증
	- 모듈간 강한 커플링
	- 복잡한 의존성
	- 일관성 없는 명명과 용어
	- 성능 문제 해결을 목표로 한 해킹
- 복잡도 때문에 유지보수가 어려우면 예산과 일정이 초과
- 복잡도를 줄이면 유지보수성이 크게 향상된다.
- 복잡도를 제거하기 위한 좋은 방법은 추상화가 있다.

## 발전성 : 변화를 쉽게 만들기

- 시스템의 요구 사항이 영원히 바뀌지 않을 가능성은 적다.
- 애자일 커뮤니티는 TDD나 리팩토링 같이 자주 변화하는 환경에서 소프트웨어를 개발할때 도움이 되는 기술과 패턴을 개발하고 있다.
- 대규모 데이터 시스템 수준에서 민첩성을 높이는 방법이 중요하다


